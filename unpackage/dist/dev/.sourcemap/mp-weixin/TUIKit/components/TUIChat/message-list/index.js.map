{"version":3,"sources":["webpack:////Users/wangwenle/Documents/有钱花/搭伙/build-fire/TUIKit/components/TUIChat/message-list/index.vue?6343","webpack:////Users/wangwenle/Documents/有钱花/搭伙/build-fire/TUIKit/components/TUIChat/message-list/index.vue?d8b3","webpack:////Users/wangwenle/Documents/有钱花/搭伙/build-fire/TUIKit/components/TUIChat/message-list/index.vue?6c0a","webpack:////Users/wangwenle/Documents/有钱花/搭伙/build-fire/TUIKit/components/TUIChat/message-list/index.vue?bd75","uni-app:///TUIKit/components/TUIChat/message-list/index.vue?vue&type=script&lang=ts&"],"names":["__sfc_main","props","groupID","type","String","default","isGroup","Boolean","setup","__props","__ctx","emits","emit","observer","groupType","sentReceiptMessageID","Set","thisInstance","proxy","messageList","isCompleted","currentConversationID","toggleID","scrollTop","TYPES","TUIChatEngine","isLoadingMessage","isLongpressing","blinkMessageIDList","messageTarget","scrollButtonInstanceRef","historyFirstMessageID","selfAddValue","broadcastNewAudioSrc","readStatusMessage","isShowReadUserStatusPanel","reSendDialogShow","resendMessageData","scrollToBottom","value","timer","setTimeout","clearTimeout","onCurrentConversationIDUpdated","conversationID","TUIStore","getConversationModel","groupProfile","watch","StoreName","CHAT","onMessageListUpdated","messageSource","onMessageSourceUpdated","onChatCompletedUpdated","CONV","uni","$on","scrollToLatestMessage","unwatch","disconnect","$off","handelScrollListScroll","e","judgeScrollOverOneScreen","leading","getGlobalAudioContext","audioMap","options","newAudioSrc","list","filter","message","isDeleted","map","vueForRenderKey","ID","newLastMessage","length","scrollAndBlinkMessage","isScrollButtonVisible","flow","bindIntersectionObserver","scrollHeight","some","messageListItem","scrollToTargetMessage","blinkMessage","undefined","flag","getHistoryMessageList","currentFirstMessageID","TUIChatService","getMessageList","then","openComplaintLink","handleToggleMessageItem","index","isLongpress","handleH5LongPress","isH5","longPressHandler","touchStartHandler","touchEndHandler","handleEdit","resendMessage","handleImagePreview","imageMessageIndex","imageMessageList","item","isRevoked","hasRiskContent","MSG_IMAGE","push","previewImage","current","indexOf","urls","payload","imageInfoArray","url","resendMessageConfirm","messageModel","messageID","Promise","splice","resolve","scrollTo","GRP_AVCHATROOM","GRP_COMMUNITY","createIntersectionObserver","threshold","observeAll","relativeTo","top","observe","res","has","id","matchingMessage","find","needReadReceipt","readReceiptInfo","isPeerRead","sendMessageReadReceipt","add","setReadReceiptPanelVisible","visible","targetMessageID","isTargetMessageInScreen","msg","scrollViewRect","originalMessageRect","finalScrollTop","TUITranslateService","t","TOAST_TYPE","WARNING","onMessageListBackgroundClick","Link","isPluginMessage","isCreateGroupCustomMessage","isPC","isMobile","components","Object","assign","MessageGroupApplication","MessageTimestamp","MessageTip","MessageBubble","MessageText","ProgressMessage","MessageImage","MessageVideo","MessageAudio","MessageFile","MessageFace","MessageLocation","MessageCustom","MessagePlugin","MessageRevoked","MessageTool","ScrollButton","Dialog","ReadReceiptPanel"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AAC6C;;;AAGjG;AACyN;AACzN,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC9GA;AAAA;AAAA;AAAA;AAAsmC,CAAgB,6+BAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;ACyL1nC;AACA;AACA;AACA;AAEA;AAmBA;AAEA;AACA;AAEA;AAA0D;AAAA;AAzB1D;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EA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","file":"TUIKit/components/TUIChat/message-list/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=405c635c&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=ts&\"\nexport * from \"./index.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./style/index.scss?vue&type=style&index=0&id=405c635c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"405c635c\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"TUIKit/components/TUIChat/message-list/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!../../../../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue2-script-setup!./index.vue?vue&type=template&id=405c635c&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.TUITranslateService.t(\n    \"TUIChat.【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。\"\n  )\n  var g1 = _vm.TUITranslateService.t(\"TUIChat.点此投诉\")\n  var g2 = !_vm.isCompleted\n    ? _vm.TUITranslateService.t(\"TUIChat.查看更多\")\n    : null\n  var l0 = _vm.__map(_vm.messageList, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var m0 =\n      item.type === _vm.TYPES.MSG_GRP_TIP ||\n      _vm.isCreateGroupCustomMessage(item)\n    var g3 = m0 ? item.getMessageContent() : null\n    var m1 = !m0 ? !item.isRevoked && !_vm.isPluginMessage(item) : null\n    var g4 = !m0 && m1 ? item.getMessageContent() : null\n    var g5 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_TEXT\n        ? item.getMessageContent()\n        : null\n    var g6 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_IMAGE\n        ? item.getMessageContent()\n        : null\n    var g7 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_IMAGE\n        ? item.getMessageContent()\n        : null\n    var g8 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_VIDEO\n        ? item.getMessageContent()\n        : null\n    var g9 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_VIDEO\n        ? item.getMessageContent()\n        : null\n    var g10 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_AUDIO\n        ? item.getMessageContent()\n        : null\n    var g11 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_FILE\n        ? item.getMessageContent()\n        : null\n    var g12 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_FACE\n        ? item.getMessageContent()\n        : null\n    var g13 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_LOCATION\n        ? item.getMessageContent()\n        : null\n    var g14 =\n      !m0 && m1 && item.type === _vm.TYPES.MSG_CUSTOM\n        ? item.getMessageContent()\n        : null\n    var m2 = !m0 && !m1 ? !item.isRevoked && _vm.isPluginMessage(item) : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      g3: g3,\n      m1: m1,\n      g4: g4,\n      g5: g5,\n      g6: g6,\n      g7: g7,\n      g8: g8,\n      g9: g9,\n      g10: g10,\n      g11: g11,\n      g12: g12,\n      g13: g13,\n      g14: g14,\n      m2: m2,\n    }\n  })\n  var g15 = _vm.reSendDialogShow\n    ? _vm.TUITranslateService.t(\"TUIChat.确认重发该消息？\")\n    : null\n  var g16 = _vm.isShowReadUserStatusPanel\n    ? Object.assign({}, _vm.readStatusMessage)\n    : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.toggleID = \"\"\n    }\n    _vm.e1 = function (e) {\n      return (_vm.reSendDialogShow = e)\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n        l0: l0,\n        g15: g15,\n        g16: g16,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/ts-loader/index.js??ref--14-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!../../../../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue2-script-setup!./index.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/ts-loader/index.js??ref--14-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!../../../../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue2-script-setup!./index.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { ref, nextTick, onMounted, onUnmounted, getCurrentInstance } from '../../../adapter-vue';\nimport TUIChatEngine, { IMessageModel, TUIStore, StoreName, TUITranslateService, TUIChatService } from '@tencentcloud/chat-uikit-engine';\nimport throttle from 'lodash/throttle';\nimport { setInstanceMapping, getBoundingClientRect, getScrollInfo } from '@tencentcloud/universal-api';\n// import { JoinGroupCard } from '@tencentcloud/call-uikit-wechat';\nimport Link from './link';\nimport MessageGroupApplication from './message-group-application/index.vue';\nimport MessageText from './message-elements/message-text.vue';\nimport ProgressMessage from '../../common/ProgressMessage/index.vue';\nimport MessageImage from './message-elements/message-image.vue';\nimport MessageAudio from './message-elements/message-audio.vue';\nimport MessageFile from './message-elements/message-file.vue';\nimport MessageFace from './message-elements/message-face.vue';\nimport MessageCustom from './message-elements/message-custom.vue';\nimport MessageTip from './message-elements/message-tip.vue';\nimport MessageBubble from './message-elements/message-bubble.vue';\nimport MessageLocation from './message-elements/message-location.vue';\nimport MessageTimestamp from './message-elements/message-timestamp.vue';\nimport MessageVideo from './message-elements/message-video.vue';\nimport MessageTool from './message-tool/index.vue';\nimport MessageRevoked from './message-tool/message-revoked.vue';\nimport MessagePlugin from '../../../plugins/plugin-components/message-plugin.vue';\nimport ReadReceiptPanel from './read-receipt-panel/index.vue';\nimport ScrollButton from './scroll-button/index.vue';\nimport { isPluginMessage } from '../../../plugins/plugin-components/index';\nimport Dialog from '../../common/Dialog/index.vue';\nimport { Toast, TOAST_TYPE } from '../../common/Toast/index';\nimport { isCreateGroupCustomMessage } from '../utils/utils';\nimport { isEnabledMessageReadReceiptGlobal } from '../utils/utils';\nimport { isPC, isH5, isMobile } from '../../../utils/env';\nimport { IAudioContext } from '../../../interface';\ninterface IEmits {\n  (e: 'closeInputToolBar'): void;\n  (e: 'handleEditor', message: IMessageModel, type: string): void;\n}\nconst __sfc_main = {};\n__sfc_main.props = {\n  groupID: {\n    type: String,\n    default: ''\n  },\n  isGroup: {\n    type: Boolean,\n    default: false\n  }\n};\n__sfc_main.setup = (__props, __ctx) => {\n  const emits = __ctx.emit;\n  const props = __props;\n  let observer: any = null;\n  let groupType: string | undefined;\n  const sentReceiptMessageID = new Set<string>();\n  const thisInstance = getCurrentInstance()?.proxy || getCurrentInstance();\n  const messageList = ref<IMessageModel[]>();\n  const isCompleted = ref(false);\n  const currentConversationID = ref('');\n  const toggleID = ref('');\n  const scrollTop = ref(5000); // 首次是 15 条消息，最大消息高度为300\n  const TYPES = ref(TUIChatEngine.TYPES);\n  const isLoadingMessage = ref(false);\n  const isLongpressing = ref(false);\n  const blinkMessageIDList = ref<string[]>([]);\n  const messageTarget = ref<IMessageModel>();\n  const scrollButtonInstanceRef = ref<InstanceType<typeof ScrollButton>>();\n  const historyFirstMessageID = ref<string>('');\n  let selfAddValue = 0;\n\n  // audio control\n  const broadcastNewAudioSrc = ref<string>('');\n\n  // 阅读回执状态message\n  const readStatusMessage = ref<IMessageModel>();\n  const isShowReadUserStatusPanel = ref<boolean>(false);\n\n  // 消息重发 Dialog\n  const reSendDialogShow = ref(false);\n  const resendMessageData = ref();\n\n  // 消息滑动到底部，建议搭配 nextTick 使用\n  const scrollToBottom = () => {\n    // 文本消息高度：60, 最大消息高度 280\n    scrollTop.value += 300;\n    // 解决 uniapp 打包到 app 首次进入滑动到底部，300 可设置\n    const timer = setTimeout(() => {\n      scrollTop.value += 1;\n      clearTimeout(timer);\n    }, 300);\n  };\n\n  // 监听回调函数\n  const onCurrentConversationIDUpdated = (conversationID: string) => {\n    currentConversationID.value = conversationID;\n\n    // 开启已读回执的状态 群聊缓存群类型\n    if (isEnabledMessageReadReceiptGlobal()) {\n      const {\n        groupProfile\n      } = TUIStore.getConversationModel(conversationID) || {};\n      groupType = groupProfile?.type;\n    }\n  };\n  onMounted(() => {\n    // 消息列表监听\n    TUIStore.watch(StoreName.CHAT, {\n      messageList: onMessageListUpdated,\n      messageSource: onMessageSourceUpdated,\n      isCompleted: onChatCompletedUpdated\n    });\n    TUIStore.watch(StoreName.CONV, {\n      currentConversationID: onCurrentConversationIDUpdated\n    });\n    setInstanceMapping('messageList', thisInstance);\n    uni.$on('scroll-to-bottom', scrollToLatestMessage);\n  });\n\n  // 取消监听\n  onUnmounted(() => {\n    TUIStore.unwatch(StoreName.CHAT, {\n      messageList: onMessageListUpdated,\n      isCompleted: onChatCompletedUpdated\n    });\n    TUIStore.unwatch(StoreName.CONV, {\n      currentConversationID: onCurrentConversationIDUpdated\n    });\n    observer?.disconnect();\n    observer = null;\n    uni.$off('scroll-to-bottom');\n  });\n  const handelScrollListScroll = throttle(function (e: Event) {\n    scrollButtonInstanceRef.value?.judgeScrollOverOneScreen(e);\n  }, 500, {\n    leading: true\n  });\n  function getGlobalAudioContext(audioMap: Map<string, IAudioContext>, options?: {\n    newAudioSrc: string;\n  }) {\n    if (options?.newAudioSrc) {\n      broadcastNewAudioSrc.value = options.newAudioSrc;\n    }\n  }\n  async function onMessageListUpdated(list: IMessageModel[]) {\n    observer?.disconnect();\n    messageList.value = list.filter(message => !message.isDeleted).map(message => {\n      message.vueForRenderKey = `${message.ID}`;\n      return message;\n    });\n    const newLastMessage = messageList.value?.[messageList.value?.length - 1];\n    if (messageTarget.value) {\n      // scroll to target message\n      scrollAndBlinkMessage(messageTarget.value);\n    } else if (!isLoadingMessage.value && !(scrollButtonInstanceRef.value?.isScrollButtonVisible && newLastMessage?.flow === 'in')) {\n      // scroll to bottom\n      nextTick(() => {\n        scrollToBottom();\n      });\n    }\n    if (isEnabledMessageReadReceiptGlobal()) {\n      nextTick(() => bindIntersectionObserver());\n    }\n  }\n\n  // 滚动到最新消息\n  async function scrollToLatestMessage() {\n    try {\n      const {\n        scrollHeight\n      } = await getScrollInfo('#messageScrollList', 'messageList');\n      if (scrollHeight) {\n        scrollTop.value === scrollHeight ? scrollTop.value = scrollHeight + 1 : scrollTop.value = scrollHeight;\n      } else {\n        scrollToBottom();\n      }\n    } catch (error) {\n      scrollToBottom();\n    }\n  }\n  async function onMessageSourceUpdated(message: IMessageModel) {\n    messageTarget.value = message;\n    scrollAndBlinkMessage(messageTarget.value);\n  }\n  function scrollAndBlinkMessage(message: IMessageModel) {\n    if (messageList.value?.some(messageListItem => messageListItem?.ID === message?.ID)) {\n      nextTick(async () => {\n        await scrollToTargetMessage(message);\n        await blinkMessage(message?.ID);\n        messageTarget.value = undefined;\n      });\n    }\n  }\n  function onChatCompletedUpdated(flag: boolean) {\n    isCompleted.value = flag;\n  }\n\n  // 获取历史消息\n  const getHistoryMessageList = () => {\n    isLoadingMessage.value = true;\n    const currentFirstMessageID = messageList.value?.[0]?.ID || '';\n    TUIChatService.getMessageList().then(() => {\n      nextTick(() => {\n        historyFirstMessageID.value = currentFirstMessageID;\n        const timer = setTimeout(() => {\n          historyFirstMessageID.value = '';\n          isLoadingMessage.value = false;\n          clearTimeout(timer);\n        }, 500);\n      });\n    });\n  };\n\n  // todo: webview 跳转\n  const openComplaintLink = () => {};\n\n  // 消息操作\n  const handleToggleMessageItem = (e: any, message: IMessageModel, index: number, isLongpress = false) => {\n    if (isLongpress) {\n      isLongpressing.value = true;\n    }\n    toggleID.value = message.ID;\n  };\n\n  // h5 long press\n  let timer: number;\n  const handleH5LongPress = (e: any, message: IMessageModel, index: number, type: string) => {\n    if (!isH5) return;\n    function longPressHandler() {\n      clearTimeout(timer);\n      handleToggleMessageItem(e, message, index, true);\n    }\n    function touchStartHandler() {\n      timer = setTimeout(longPressHandler, 500);\n    }\n    function touchEndHandler() {\n      clearTimeout(timer);\n    }\n    switch (type) {\n      case 'touchstart':\n        touchStartHandler();\n        break;\n      case 'touchend':\n        touchEndHandler();\n        setTimeout(() => {\n          isLongpressing.value = false;\n        }, 200);\n        break;\n    }\n  };\n\n  // 消息撤回后，编辑消息\n  const handleEdit = (message: IMessageModel) => {\n    emits('handleEditor', message, 'reedit');\n  };\n\n  // 重发消息\n  const resendMessage = (message: IMessageModel) => {\n    reSendDialogShow.value = true;\n    resendMessageData.value = message;\n  };\n\n  // 图片预览\n  // 开启图片预览\n  const handleImagePreview = (index: number) => {\n    if (!messageList.value) {\n      return;\n    }\n    const imageMessageIndex: number[] = [];\n    const imageMessageList: IMessageModel[] = messageList.value.filter((item, index) => {\n      if (!item.isRevoked && !item.hasRiskContent && item.type === TYPES.value.MSG_IMAGE) {\n        imageMessageIndex.push(index);\n        return true;\n      }\n      return false;\n    });\n    uni.previewImage({\n      current: imageMessageIndex.indexOf(index),\n      urls: imageMessageList.map(message => message.payload.imageInfoArray?.[2].url),\n\n\n\n    });\n  };\n  const resendMessageConfirm = () => {\n    reSendDialogShow.value = !reSendDialogShow.value;\n    const messageModel = resendMessageData.value;\n    messageModel.resendMessage();\n  };\n  function blinkMessage(messageID: string): Promise<void> {\n    return new Promise(resolve => {\n      const index = blinkMessageIDList.value.indexOf(messageID);\n      if (index < 0) {\n        blinkMessageIDList.value.push(messageID);\n        const timer = setTimeout(() => {\n          blinkMessageIDList.value.splice(blinkMessageIDList.value.indexOf(messageID), 1);\n          clearTimeout(timer);\n          resolve();\n        }, 3000);\n      }\n    });\n  }\n  function scrollTo(scrollHeight: number) {\n    scrollTop.value = scrollHeight;\n  }\n  async function bindIntersectionObserver() {\n    if (!messageList.value || messageList.value.length === 0) {\n      return;\n    }\n    if (groupType === TYPES.value.GRP_AVCHATROOM || groupType === TYPES.value.GRP_COMMUNITY) {\n      // 直播群以及社群不进行消息的已读回执监听\n      return;\n    }\n    observer?.disconnect();\n    observer = uni.createIntersectionObserver(thisInstance, {\n      threshold: [0.7],\n      observeAll: true\n      // uni 下会把 safetip 也算进去 需要负 margin 来排除\n    }).relativeTo('#messageScrollList', {\n      top: -70\n    });\n    observer?.observe('.message-li.in .message-bubble-container', (res: any) => {\n      if (sentReceiptMessageID.has(res.id)) {\n        return;\n      }\n      const matchingMessage = messageList.value.find((message: IMessageModel) => {\n        return res.id.indexOf(message.ID) > -1;\n      });\n      if (matchingMessage && matchingMessage.needReadReceipt && matchingMessage.flow === 'in' && !matchingMessage.readReceiptInfo?.isPeerRead) {\n        TUIChatService.sendMessageReadReceipt([matchingMessage]);\n        sentReceiptMessageID.add(res.id);\n      }\n    });\n  }\n  function setReadReceiptPanelVisible(visible: boolean, message?: IMessageModel) {\n    if (!visible) {\n      readStatusMessage.value = undefined;\n    } else {\n      readStatusMessage.value = message;\n    }\n    isShowReadUserStatusPanel.value = visible;\n  }\n  async function scrollToTargetMessage(message: IMessageModel) {\n    const targetMessageID = message.ID;\n    const isTargetMessageInScreen = messageList.value && messageList.value.some(msg => msg.ID === targetMessageID);\n    if (targetMessageID && isTargetMessageInScreen) {\n      const timer = setTimeout(async () => {\n        try {\n          const scrollViewRect = await getBoundingClientRect('#messageScrollList', 'messageList');\n          const originalMessageRect = await getBoundingClientRect('#tui-' + targetMessageID, 'messageList');\n          const {\n            scrollTop\n          } = await getScrollInfo('#messageScrollList', 'messageList');\n          const finalScrollTop = originalMessageRect.top + scrollTop - scrollViewRect.top - selfAddValue++ % 2;\n          scrollTo(finalScrollTop);\n          clearTimeout(timer);\n        } catch (error) {\n          // todo\n        }\n      }, 500);\n    } else {\n      Toast({\n        message: TUITranslateService.t('TUIChat.无法定位到原消息'),\n        type: TOAST_TYPE.WARNING\n      });\n    }\n  }\n  function onMessageListBackgroundClick() {\n    emits('closeInputToolBar');\n  }\n  return {\n    TUITranslateService,\n    Link,\n    isPluginMessage,\n    isCreateGroupCustomMessage,\n    isPC,\n    isMobile,\n    props,\n    messageList,\n    isCompleted,\n    toggleID,\n    scrollTop,\n    TYPES,\n    blinkMessageIDList,\n    scrollButtonInstanceRef,\n    historyFirstMessageID,\n    broadcastNewAudioSrc,\n    readStatusMessage,\n    isShowReadUserStatusPanel,\n    reSendDialogShow,\n    handelScrollListScroll,\n    getGlobalAudioContext,\n    scrollToLatestMessage,\n    getHistoryMessageList,\n    openComplaintLink,\n    handleToggleMessageItem,\n    handleH5LongPress,\n    handleEdit,\n    resendMessage,\n    handleImagePreview,\n    resendMessageConfirm,\n    blinkMessage,\n    scrollTo,\n    setReadReceiptPanelVisible,\n    onMessageListBackgroundClick\n  };\n};\n__sfc_main.components = Object.assign({\n  MessageGroupApplication,\n  MessageTimestamp,\n  MessageTip,\n  MessageBubble,\n  MessageText,\n  ProgressMessage,\n  MessageImage,\n  MessageVideo,\n  MessageAudio,\n  MessageFile,\n  MessageFace,\n  MessageLocation,\n  MessageCustom,\n  MessagePlugin,\n  MessageRevoked,\n  MessageTool,\n  ScrollButton,\n  Dialog,\n  ReadReceiptPanel\n}, __sfc_main.components);\nexport default __sfc_main;\n"],"sourceRoot":""}